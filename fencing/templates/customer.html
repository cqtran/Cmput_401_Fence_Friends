{% extends "base.html" %}
{% block head %}
  {{ super() }}
  <link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='customer.css') }}">
{% endblock %}
{% block content %}


<h1>Customers</h1>

<form style="display: none;">
  <input id="search" onkeyup="updateCustomerList()" onpaste="updateCustomerList()" type="text" class="form-control" placeholder="Search">
</form>

<hr class="mt-2">
<div class="col-lg-12">
  <div class="row" id="customerlist"></div>
</div>

<script type="text/javascript">

  // Get the <datalist> and <input> elements.
  var customerList = document.getElementById('customerlist');

  var search = document.getElementById('search');

  // Create a new XMLHttpRequest.
  var request = new XMLHttpRequest();

  // Handle state changes for the request.
  request.onreadystatechange = function(response) {
  if (request.readyState === 4) {
    if (request.status === 200) {
      // Parse the JSON
      var jsonOptions = JSON.parse(request.responseText);

      searchValue = search.value.trim().toLowerCase();

      // Loop over the JSON array.
      jsonOptions.forEach(function(customer) {
        var item = document.createElement('div');
        var final = document.createElement('div');
        var link = document.createElement('a');
        var inner = document.createElement('div');
        var name = document.createElement('h2');
        var number = document.createElement('h6');
        var email = document.createElement('h6');

        email.setAttribute('class', 'card-body mb-1 text-center no-padding');
        email.innerText = customer.email;

        number.setAttribute('class', 'card-body mb-1 text-center no-padding');
        number.innerText = customer.cellphone;

        name.setAttribute('class', 'card-title mb-1 text-center no-padding');
        name.innerText = customer.first_name;

        link.setAttribute('href', '#')

        inner.setAttribute('class', 'card-body');
        inner.appendChild(name);
        inner.appendChild(number);
        inner.appendChild(email);

        link.appendChild(inner);
        item.setAttribute('class', 'card mb-2');
        final.setAttribute('class', 'less-padding card-row col-lg-4 col-md-6')

        // this is where you want to go when you click
        //item.setAttribute('onclick', 'window.location.href="{{ url_for('projects') }}"' )
        link.setAttribute('onclick', 'customerClicked('+customer.customer_id+')')

        item.appendChild(link);
        final.appendChild(item);
        // Add it to the list:
        customerList.appendChild(final);
      });

    } else {
      var item = document.createElement('a');
      item.appendChild(document.createTextNode('An error has occurred'));
      customerList.appendChild(item);
    }
  }
  };

  function updateCustomerList() {
    customerList.innerHTML = "";
    // Set up and make the request.
    searchValue = search.value.trim().toLowerCase();
    request.open('GET', '/getCustomerList?search=' + searchValue, true);
    request.send();
  }

  function customerClicked(id) {
  	window.location.href= '/customerinfo?cust_id=' + id + "&status=All"
  }

  updateCustomerList();

</script>
{% endblock %}
